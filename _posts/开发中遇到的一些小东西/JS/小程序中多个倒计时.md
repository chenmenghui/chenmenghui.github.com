---
title: 小程序中多个倒计时
date: 2019-02-25
categories: js
tags: 
- js运用
- 实用代码片段
---

```js
// pages/test/test.js
Page({

    /**
     * 页面的初始数据
     */
    data: {
        times: [
            "2019-02-26 16:14:58",
            "2019-03-24 16:34:58",
            "2019-02-27 16:14:58",
            "2019-02-24 12:14:58",
        ],
        count_downs: [],
    },

    /**
     * 生命周期函数--监听页面显示
     */
    onShow: function () {
        countDown(this);
    },
});

var timepiece = {
    /**
     * 时间戳转化成时间
     * @param stamp
     * @returns {string}
     */
    stamp2time: function (stamp) {
        var d = new Date(stamp * 1000);    //根据时间戳生成的时间对象
        var date = (d.getFullYear()) + "-" +
            (d.getMonth() + 1) + "-" +
            (d.getDate()) + " " +
            (d.getHours()) + ":" +
            (d.getMinutes()) + ":" +
            (d.getSeconds());
        return date;
    },

    /**
     * 时间转化成时间戳
     * @param stamp
     * @returns {number}
     */
    time2stamp: function (time) {
        time = time.substring(0, 19);
        time = time.replace(/-/g, '/');
        return Math.round(new Date(time).getTime() / 1000);
    },

    /**
     * 秒转化成时分秒的形式
     * @param second
     */
    second2hour: function (value) {
        var secondTime = parseInt(value);
        var minuteTime = 0;
        var hourTime = 0;
        if (secondTime > 60) {
            minuteTime = parseInt(secondTime / 60);
            secondTime = parseInt(secondTime % 60);
            if (minuteTime > 60) {
                hourTime = parseInt(minuteTime / 60);
                minuteTime = parseInt(minuteTime % 60);
            }
        }
        if (hourTime < 10) {
            hourTime = `0${hourTime}`
        }
        if (minuteTime < 10) {
            minuteTime = `0${minuteTime}`
        }
        if (secondTime < 10) {
            secondTime = `0${secondTime}`
        }
        var result = `${hourTime}:${minuteTime}:${secondTime}`;
        return result;
    },

    /**
     * 时间和当前时间的差值
     * @param time
     */
    remain: function (time) {
        var now = Math.round(new Date().getTime() / 1000);
        time = this.time2stamp(time);
        time = time - now;
        if (time <= 0) {
            time = 0;
        }
        return this.second2hour(time);
    },
};

/**
 * 倒计时
 * @param that
 * @param times
 */
var countDown = function (that) {
    setInterval(function () {
        var counts = [];
        for (var i in that.data.times) {
            counts[i] = timepiece.remain(that.data.times[i])
        }
        that.setData({
            count_downs: counts
        })
    }, 1000);
};
```
